# Story: Support date-only format for --due-at option

**Status:** Accepted
**Created:** 2025-12-23T11:31:35

## User Story

As a user creating tasks with deadlines,
I want to specify due dates using just the date portion (e.g., `2025-12-25`),
So that I don't have to type the full datetime when I mean "by end of day".

## Background

Currently, `mm task "Test" --due-at "2025-12-25"` fails because the parser expects a full datetime format. Users naturally think of deadlines as "by this date", which semantically means "by the end of that day" (23:59:59).

## Acceptance Criteria

### Given-When-Then

```gherkin
Scenario: Create task with date-only due date
  Given a workspace with timezone "UTC"
  When I run `mm task "Review PR" --due-at "2025-01-20"`
  Then a task is created with dueAt set to "2025-01-20T23:59:59" in UTC

Scenario: Create task with date-only due date in JST timezone
  Given a workspace with timezone "Asia/Tokyo"
  When I run `mm task "Review PR" --due-at "2025-01-20"`
  Then a task is created with dueAt set to "2025-01-20T23:59:59" in JST
  And the stored UTC value is "2025-01-20T14:59:59.000Z"

Scenario: Create task with explicit datetime due date
  Given a workspace
  When I run `mm task "Meeting prep" --due-at "2025-01-20T15:00:00"`
  Then a task is created with dueAt set to that exact datetime
```

## Technical Design

### Approach: Type-safe union type `CalendarDay | DateTime`

The `dueAt` field in `CreateItemInput` accepts either:
- `CalendarDay`: date-only, converted to end of day (23:59:59) in workflow
- `DateTime`: exact datetime, used as-is

This approach:
- Preserves semantic meaning through types
- Keeps conversion logic in the item creation workflow (domain layer)
- Doesn't change general-purpose `parseDateTime` behavior

### Files Modified

1. **`src/domain/workflows/create_item.ts`**
   - Changed `dueAt` type from `DateTime` to `CalendarDay | DateTime`
   - Added `calendarDayToEndOfDay` helper function
   - Added conversion logic before applying schedule

2. **`src/domain/workflows/create_item_test.ts`**
   - Added test for CalendarDay dueAt in UTC timezone
   - Added test for CalendarDay dueAt in JST timezone

3. **`src/presentation/cli/commands/task.ts`**
   - Updated to try `parseCalendarDay` first, fall back to `parseDateTime`
   - Passes CalendarDay directly to workflow when date-only input

## Implementation Log

### 2025-12-23

- [x] Created story log
- [x] Updated `CreateItemInput.dueAt` type to `CalendarDay | DateTime`
- [x] Added `calendarDayToEndOfDay` helper function in workflow
- [x] Added conversion logic in `CreateItemWorkflow.execute`
- [x] Updated task command to parse date-only as CalendarDay
- [x] Added unit tests (2 new tests)
- [x] All tests pass (482 tests)
- [x] Acceptance testing passed (AC.1, AC.2, AC.3)
