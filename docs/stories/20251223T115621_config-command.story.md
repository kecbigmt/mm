## Story Log

### Goal
Add a generic `mm config` command to view and modify workspace settings.

### Why
Currently, the only way to configure sync settings is through `mm sync init`. Users need a flexible way to:
- View all workspace settings (`mm config list`)
- Get specific settings (`mm config get <key>`)
- Modify settings (`mm config set <key> <value>`)

This provides a consistent, extensible interface for all workspace configuration, not just sync settings.

Additionally, this story includes renaming `sync_mode` to `mode` in workspace.json for consistency (removing redundant "sync" prefix within the sync object).

### User Story
**As a mm user, I want to view and modify workspace settings with `mm config`, so that I can adjust configuration without re-initializing or manually editing workspace.json.**

### Acceptance Criteria

#### 1. List All Settings
- [x] **Given** a workspace, **When** you run `mm config list`, **Then** all settings from workspace.json are displayed (timezone, sync.enabled, sync.mode, sync.vcs, sync.git.remote, sync.git.branch)

#### 2. Get Specific Setting
- [x] **Given** a workspace, **When** you run `mm config get sync.mode`, **Then** the current mode value is displayed (e.g., `auto-commit`)
- [x] **Given** a workspace, **When** you run `mm config get sync.enabled`, **Then** `true` or `false` is displayed
- [x] **Given** a workspace, **When** you run `mm config get timezone`, **Then** the current timezone is displayed (e.g., `Asia/Tokyo`)
- [x] **Given** a non-existent key, **When** you run `mm config get foo.bar`, **Then** an error is displayed: "Unknown config key: foo.bar"

#### 3. Set sync.mode
- [x] **Given** sync.mode is `auto-commit`, **When** you run `mm config set sync.mode auto-sync`, **Then** workspace.json is updated with `mode: "auto-sync"`
- [x] **Given** sync.mode is `auto-sync`, **When** you run `mm config set sync.mode auto-commit`, **Then** workspace.json is updated with `mode: "auto-commit"`
- [x] **Given** an invalid mode value, **When** you run `mm config set sync.mode invalid`, **Then** an error is displayed: "Invalid value for sync.mode: must be 'auto-commit' or 'auto-sync'"

#### 4. Set sync.enabled
- [x] **Given** sync.enabled is false and sync.git.remote is configured, **When** you run `mm config set sync.enabled true`, **Then** workspace.json is updated with `sync.enabled: true`
- [x] **Given** sync.enabled is true, **When** you run `mm config set sync.enabled false`, **Then** workspace.json is updated with `sync.enabled: false`
- [x] **Given** sync.enabled is false and sync.git.remote is NOT configured, **When** you run `mm config set sync.enabled true`, **Then** an error is displayed: "Cannot enable sync: no remote configured. Run `mm sync init <remote-url>` first."

#### 5. Set sync.git.remote
- [x] **Given** a workspace with git initialized, **When** you run `mm config set sync.git.remote <new-url>`, **Then** workspace.json is updated AND git remote origin is updated

#### 6. Set sync.git.branch
- [x] **Given** a workspace with git initialized, **When** you run `mm config set sync.git.branch <new-branch>`, **Then** workspace.json is updated with the new branch name
- [x] **Given** an invalid branch name, **When** you run `mm config set sync.git.branch <invalid>`, **Then** an error is displayed with the git validation message

#### 7. Set timezone
- [x] **Given** a workspace, **When** you run `mm config set timezone America/New_York`, **Then** workspace.json is updated with the new timezone

#### 8. Auto-commit/sync for All Settings Changes
- [x] **Given** sync.enabled is true in `auto-commit` mode, **When** any setting is changed via `mm config set`, **Then** workspace.json is automatically committed with message "mm: update workspace configuration"
- [x] **Given** sync.enabled is true in `auto-sync` mode, **When** any setting is changed via `mm config set`, **Then** workspace.json is committed AND pushed to remote
- [x] **Given** sync.enabled is false, **When** any setting is changed via `mm config set`, **Then** no commit is created

#### 9. Error Cases
- [x] **Given** git is not initialized, **When** you run `mm config set sync.git.remote <url>`, **Then** an error is displayed suggesting to run `mm sync init` first
- [x] **Given** an unknown key, **When** you run `mm config set unknown.key value`, **Then** an error is displayed: "Unknown config key: unknown.key"

### Supported Config Keys

| Key | Type | Description |
|-----|------|-------------|
| `timezone` | string | Workspace timezone (e.g., "Asia/Tokyo") |
| `sync.vcs` | string | VCS type (currently only "git") - read-only |
| `sync.enabled` | boolean | Whether sync is active |
| `sync.mode` | string | "auto-commit" or "auto-sync" |
| `sync.git.remote` | string | Git remote URL |
| `sync.git.branch` | string | Git branch name |

### Out of Scope
- Interactive configuration wizard
- Validating remote URL connectivity
- Automatic branch switching (only updates workspace.json, doesn't checkout)
- Setting `sync.vcs` (read-only, always "git")

---

### Completed Work Summary

#### Implementation (2024-12-23)
1. **Renamed `sync_mode` to `mode`** in workspace.json and all related code (22 files updated)
2. **Created `mm config` command** with three subcommands:
   - `mm config` / `mm config list` - Display all configuration settings
   - `mm config get <key>` - Get a specific configuration value
   - `mm config set <key> <value>` - Set a configuration value with validation
3. **Supported keys**: timezone, sync.vcs (read-only), sync.enabled, sync.mode, sync.git.remote, sync.git.branch
4. **Auto-commit/sync**: When sync is enabled, configuration changes are automatically committed (and pushed in auto-sync mode)
5. **All tests pass**: 480 unit tests, sync E2E tests (scenarios 21-23)

#### Key Files Created/Modified
- `src/presentation/cli/commands/config.ts` - New config command
- `src/domain/models/workspace.ts` - Renamed syncMode to mode
- `src/main.ts` - Registered config command
- `tests/e2e/scenarios/scenario_26_config_command_test.ts` - E2E tests for config command (17 test cases)

### Acceptance Checks

**Status: Accepted**

All acceptance criteria verified and passing.
Tested on: 2024-12-23

Developer verification completed:
- [x] `mm config` displays all settings
- [x] `mm config list` displays all settings
- [x] `mm config get <key>` returns the value
- [x] `mm config set sync.mode auto-sync` updates workspace.json
- [x] `mm config set sync.enabled true` requires remote to be configured
- [x] Auto-commit works when sync is enabled
- [x] All unit tests pass (480)
- [x] Sync E2E tests pass (scenarios 21-23)
- [x] Config E2E tests pass (scenario 26, 17 test cases)

Product owner acceptance testing completed:
- [x] AC.1: List all settings
- [x] AC.2: Get specific setting (4 criteria)
- [x] AC.3: Set sync.mode (3 criteria)
- [x] AC.4: Set sync.enabled (3 criteria)
- [x] AC.5: Set sync.git.remote
- [x] AC.6: Set sync.git.branch (2 criteria)
- [x] AC.7: Set timezone
- [x] AC.8: Auto-commit/sync behavior (3 criteria)
- [x] AC.9: Error cases (2 criteria)

### Follow-ups / Open Risks

#### Addressed
- `sync.enabled = true` requires remote to be configured (error if not)

#### Remaining
- Consider adding `--json` output format for scripting
- Consider timezone validation (check against IANA timezone database)
