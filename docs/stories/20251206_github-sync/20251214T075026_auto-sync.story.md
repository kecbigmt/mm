## Story Log

### Goal
Implement auto-sync mode to automatically push commits to remote repository after state-changing commands.

### Why
Users running in `auto-commit` mode currently have their changes automatically committed locally, but they must manually run `mm sync` to push to remote. Implementing `auto-sync` mode enables continuous synchronization across devices by automatically pushing commits after each state-changing operation, completing the GitHub Sync epic's automation goals.

### User Story
**As a mm user, I want `sync_mode="auto-sync"` to automatically push my commits to GitHub after state-changing commands, so that my workspace is continuously synchronized across devices without manual sync operations.**

### Acceptance Criteria

#### 1. Auto-sync on Node Creation Commands
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm note <content>`, **Then** a Git commit is created and automatically pushed to the remote repository.
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm task <content>`, **Then** a Git commit is created and automatically pushed to the remote repository.
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm event <content>`, **Then** a Git commit is created and automatically pushed to the remote repository.

#### 2. Auto-sync on State-changing Commands
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm mv <source> <target>`, **Then** a Git commit is created and automatically pushed to the remote repository.
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm remove <path>`, **Then** a Git commit is created and automatically pushed to the remote repository.
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm close <task-path>`, **Then** a Git commit is created and automatically pushed to the remote repository.
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm reopen <task-path>`, **Then** a Git commit is created and automatically pushed to the remote repository.
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm snooze <task-path>`, **Then** a Git commit is created and automatically pushed to the remote repository.
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm edit <path>` and save changes, **Then** a Git commit is created and automatically pushed to the remote repository.
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** I run `mm close <task1> <task2> <task3>` (multiple items), **Then** a single Git commit is created for all successfully processed items and automatically pushed to the remote repository.

#### 3. Push Rejection Handling
- [ ] **Given** `sync_mode="auto-sync"` and push is rejected (non-fast-forward), **When** auto-sync runs, **Then** it attempts a fast-forward pull (`git pull --ff-only`).
- [ ] **Given** fast-forward pull succeeds, **When** auto-sync retries push, **Then** the push succeeds and changes are synchronized.
- [ ] **Given** fast-forward pull fails or retry push fails, **When** auto-sync completes, **Then** a warning message is displayed: "[mm] Auto-sync failed due to non-fast-forward update. Resolve manually and rerun mm sync."
- [ ] **Given** auto-sync fails, **When** the warning is shown, **Then** the filesystem changes remain applied (no rollback).

#### 4. No Auto-sync When Disabled
- [ ] **Given** `git.enabled=false`, **When** I run any state-changing command, **Then** no Git commit or push is performed.
- [ ] **Given** `git.enabled=true` and `sync_mode="auto-commit"`, **When** I run a state-changing command, **Then** a Git commit is created but no push is performed (existing behavior).

#### 5. Error Handling
- [ ] **Given** auto-sync is triggered but push fails due to network error, **When** the command completes, **Then** a warning is displayed with the Git error message but the filesystem changes remain applied.
- [ ] **Given** auto-sync is triggered but push fails due to authentication error, **When** the command completes, **Then** a warning is displayed with the Git error message but the filesystem changes remain applied.
- [ ] **Given** there are no actual changes to commit (Git working tree clean), **When** auto-sync is triggered, **Then** no commit or push is performed and no error is shown.

#### 6. Output Messages
- [ ] **Given** auto-sync performs fast-forward pull and retry, **When** the operation completes successfully, **Then** informational output indicates the pull and retry occurred (e.g., "[mm] Auto-sync: pulled remote changes and retried push successfully").

### Out of Scope
- Non-fast-forward automatic merges (manual resolution required per Epic design)
- Multiple retry attempts (only one retry after fast-forward pull)
- Custom commit message templates (`git.commit_template` is future work)
- Author name/email overrides (`git.author_name`/`git.author_email` is future work)
- Progress indicators or spinners during network operations

---

### Completed Work Summary
Not yet started.

### Acceptance Checks

**Status: Pending Product Owner Review**

Developer verification completed:
- [List what the developer manually verified]
- [Note any observations or findings]

**Awaiting product owner acceptance testing before marking this user story as complete.**

### Follow-ups / Open Risks

#### Addressed
- [Items that were concerns but have been resolved]

#### Remaining
- [Known limitations or technical debt]
- [Future considerations]
- [Potential risks to be aware of]
