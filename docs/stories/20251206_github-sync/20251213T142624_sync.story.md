## Story Log

### Goal
Implement `mm sync` command (without arguments) to perform full synchronization (pull + push) in a single operation.

### Why
Users running in `auto-commit` mode need a convenient way to manually synchronize their workspace with the remote repository. Currently they must run `mm sync pull` and `mm sync push` separately. A single `mm sync` command provides a better user experience and follows the design specified in Epic section 6.3.

### User Story
**As a mm user, I want to run `mm sync` to pull and push changes in one command, so that I can quickly synchronize my workspace with the remote repository without running multiple commands.**

### Acceptance Criteria

#### 1. Happy Path - Full Sync
- [x] **Given** git.enabled=true and workspace has a configured remote, **When** you run `mm sync`, **Then** it executes pull followed by push and displays both operations' output

#### 2. Pull-only Success
- [x] **Given** pull succeeds but there are no local commits to push, **When** you run `mm sync`, **Then** it completes successfully with appropriate "up-to-date" message

#### 3. Error Cases - Git Not Enabled
- [x] **Given** git.enabled=false, **When** you run `mm sync`, **Then** it displays an error that Git sync is not enabled

#### 4. Error Cases - Pull Failure
- [x] **Given** pull fails (e.g., non-fast-forward), **When** you run `mm sync`, **Then** it stops after pull failure and does not attempt push

#### 5. Error Cases - Push Failure
- [x] **Given** pull succeeds but push fails, **When** you run `mm sync`, **Then** it displays the push error message

#### 6. Workspace Option
- [x] **Given** I specify `--workspace test-ws`, **When** you run `mm sync --workspace test-ws`, **Then** it syncs the specified workspace

### Out of Scope
- `mm doctor --rebuild-index` integration (mentioned in Epic 6.3 as "optional" - will be addressed in a future story if needed)
- Auto-sync mode implementation (separate story)
- Custom sync direction options (e.g., `--pull-only`, `--push-only`)

---

### Completed Work Summary

Implemented `mm sync` command that executes pull + push operations in sequence.

**Implementation:**
- Created `SyncWorkflow` (`src/domain/workflows/sync.ts`) that orchestrates `SyncPullWorkflow` and `SyncPushWorkflow`
- Added default action to `mm sync` CLI command (`src/presentation/cli/commands/sync.ts`)
- Workflow stops on pull failure (push not attempted)
- Combines output from both operations with clear "Pull:" and "Push:" labels for readability

**Test Coverage:**
- 6 unit tests covering all acceptance criteria scenarios
- All tests passing (`deno task test`)

### Acceptance Checks

**Status: ✅ ACCEPTED by Product Owner**

Developer verification completed:
- ✅ All 6 unit tests passing (workflow logic verified with mocked dependencies)
- ✅ `mm sync --help` displays command information correctly
- ✅ Code compiles successfully

End-to-end acceptance testing completed with actual Git repository:
- ✅ AC1: Happy Path - Full Sync (pull + push both execute and display labeled output)
- ✅ AC2: Pull-only Success (completes with "up-to-date" messages when nothing to push)
- ✅ AC3: Error - Git Not Enabled (displays actionable error message)
- ✅ AC4: Error - Pull Failure (stops after pull failure, push not attempted)
- ✅ AC5: Error - Push Failure (displays push error after successful pull)
- ✅ AC6: Workspace Option (--workspace flag correctly targets specified workspace)

**✅ Product owner acceptance: 2025-12-14**

This user story is complete.

### Follow-ups / Open Risks

#### Addressed
- ✅ Output formatting improved with "Pull:" and "Push:" labels for clarity
- ✅ End-to-end acceptance testing completed with actual git repository

#### Remaining
- `mm doctor --rebuild-index` integration mentioned in Epic 6.3 is deferred to future story
- Auto-sync mode implementation (separate epic feature)
