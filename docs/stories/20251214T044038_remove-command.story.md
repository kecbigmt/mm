## Story Log

### Goal
Implement the `mm remove` (alias `mm rm`) command to delete items from the workspace with auto-commit support.

### Why
Users need a way to permanently delete items (notes, tasks, events) from their workspace when they are no longer needed. This command provides a safe, explicit way to remove items by ID or alias, with automatic Git commits when sync mode is enabled, ensuring deleted items are tracked in version history.

### User Story
**As a mm user, I want to delete items using `mm remove <ids...>` or `mm rm <ids...>`, so that I can permanently remove unwanted notes, tasks, or events from my workspace.**

### Acceptance Criteria

#### 1. Basic Remove Command
- [x] **Given** a workspace with an existing item, **When** you run `mm remove <item-id>`, **Then** the item file is deleted from the filesystem.
- [x] **Given** a workspace with an existing item with alias "meeting", **When** you run `mm remove meeting`, **Then** the item is deleted using the alias.
- [x] **Given** a workspace with multiple items, **When** you run `mm remove <id1> <id2> <id3>`, **Then** all specified items are deleted.
- [x] **Given** a workspace with items, **When** you run `mm rm <item-id>` (shorthand), **Then** the item is deleted (alias works).

#### 2. Success Feedback
- [x] **Given** you successfully remove a single item with ID "abc123" and title "Old note", **When** the command completes, **Then** you see `✅ Removed [abc123] Old note`.
- [x] **Given** you successfully remove a single item with alias "meeting" and title "Team sync", **When** the command completes, **Then** you see `✅ Removed [meeting] Team sync`.
- [x] **Given** you successfully remove multiple items, **When** the command completes, **Then** you see `✅ Removed N item(s):` followed by a list with `[id/alias] title` for each.

#### 3. Error Handling
- [x] **Given** you run `mm remove` with no arguments, **When** the command executes, **Then** you see error "At least one item ID is required".
- [x] **Given** you run `mm remove nonexistent-id`, **When** the command executes, **Then** you see an error indicating the item was not found.
- [x] **Given** you remove multiple items where some don't exist, **When** the command completes, **Then** successful deletions are performed and errors are shown for failures.
- [x] **Given** some items fail to delete (e.g., file permissions), **When** the command completes, **Then** you see `❌ N error(s) occurred:` with details for each failure.
- [x] **Given** any items failed to delete, **When** the command completes, **Then** the process exits with code 1.

#### 4. Alias Resolution
- [x] **Given** an item with alias "task-1", **When** you run `mm remove task-1`, **Then** the alias is resolved to the item ID and the item is deleted.
- [x] **Given** you provide both IDs and aliases in one command, **When** you run `mm remove id1 alias1 id2`, **Then** all items are resolved and deleted correctly.

#### 5. Auto-commit Integration
- [x] **Given** `git.enabled=true` and `sync_mode="auto-commit"`, **When** you run `mm remove <id>`, **Then** a Git commit is created after the item is deleted.
- [x] **Given** `git.enabled=true` and `sync_mode="auto-sync"`, **When** you run `mm remove <id>`, **Then** a Git commit is created after the item is deleted.
- [x] **Given** `git.enabled=false`, **When** you run `mm remove <id>`, **Then** no Git commit is created.
- [x] **Given** you successfully remove 3 items, **When** auto-commit runs, **Then** the commit message is `mm: remove 3 item(s)`.
- [x] **Given** auto-commit fails but items were deleted, **When** the command completes, **Then** a warning is displayed but the deletions remain applied.

#### 6. Workspace Option
- [x] **Given** you have multiple workspaces, **When** you run `mm remove <id> --workspace other-workspace`, **Then** the item is removed from the specified workspace.

### Out of Scope
- Soft delete / trash functionality (items are permanently deleted)
- Undo/restore for deleted items (use Git history if needed)
- Cascade deletion of related items or references
- Confirmation prompt before deletion (user must be explicit with IDs/aliases)
- Deletion of containers (only items can be removed)
- Custom commit messages for auto-commit

---

### Completed Work Summary

**Implementation completed on 2025-12-14**

Created:
- `src/domain/workflows/remove_item.ts` - Core remove workflow logic with ID/alias resolution
- `src/domain/workflows/remove_item_test.ts` - 7 unit tests covering all scenarios
- `src/presentation/cli/commands/remove.ts` - CLI handler with auto-commit integration

Modified:
- `src/main.ts` - Registered `remove` command with `rm` alias

Test Results:
- Unit tests: 7 passed (RemoveItemWorkflow)
- Full test suite: All tests passing
- Linting: Clean (deno lint)
- Formatting: Clean (deno fmt)

### Acceptance Checks

**Status: Ready for Product Owner Acceptance**

Developer verification completed:
- All 25 acceptance criteria verified manually in test workspace
- Category 1 (Basic Remove Command): 4/4 verified - ID, alias, multiple items, rm alias
- Category 2 (Success Feedback): 3/3 verified - single/multiple item feedback formats
- Category 3 (Error Handling): 5/5 verified - no args, not found, partial failure, error display, exit codes
- Category 4 (Alias Resolution): 2/2 verified - alias resolution, mixed ID/alias
- Category 5 (Auto-commit Integration): 5/5 verified - auto-commit/auto-sync modes, git disabled, commit message format, error handling (unit test)
- Category 6 (Workspace Option): 1/1 verified - --workspace flag works correctly
- All unit tests passing (7 tests in remove_item_test.ts)
- Full test suite passing (20 passed, 163 steps)
- Linting and formatting clean

**Awaiting product owner acceptance testing.**

### Follow-ups / Open Risks

#### Addressed
- N/A - Implementation was straightforward following existing patterns

#### Remaining
- Cache does not get updated when items are removed (by design - see story discussion)
  - Removed aliases may remain in completion cache until cache rebuild
  - Not a critical issue as invalid aliases will fail gracefully at execution time
- Auto-commit story (20251214T025111_auto-commit.story.md) can now be marked complete
  - The pending acceptance criterion for `mm remove` auto-commit is now fulfilled
