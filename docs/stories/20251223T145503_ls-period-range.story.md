## Story Log

### Goal
Make `mm ls this-week` and `mm ls this-month` display items for the entire period, not just the first day.

### Why
Currently, `mm ls this-week` only shows items from Monday (the start of the week) and `mm ls this-month` only shows items from the 1st of the month. Users expect these commands to show all items within the specified period - all weekdays for `this-week` and all days for `this-month`.

### User Story
**As a mm user, I want `mm ls this-week` to list items from Monday to Sunday and `mm ls this-month` to list items from the 1st to the last day, so that I can see all items in the specified period with a single command.**

### Acceptance Criteria

#### 1. this-week Range
- [x] **Given** today is any day of the week, **When** running `mm ls this-week`, **Then** it displays items from Monday to Sunday of the current week
- [x] **Given** today is any day of the week, **When** running `mm ls tw` (alias), **Then** it behaves the same as `this-week`
- [x] **Given** items exist on different days, **When** running `mm ls this-week`, **Then** all items from Mon-Sun appear grouped by date

#### 2. next-week / last-week Range
- [x] **Given** today is any day, **When** running `mm ls next-week`, **Then** it displays items from Monday to Sunday of the next week
- [x] **Given** today is any day, **When** running `mm ls last-week`, **Then** it displays items from Monday to Sunday of the previous week

#### 3. this-month Range
- [x] **Given** today is any day of December 2025, **When** running `mm ls this-month`, **Then** it displays items from December 1st to December 31st
- [x] **Given** today is in February of a leap year, **When** running `mm ls this-month`, **Then** it correctly handles the 29-day month

#### 4. next-month / last-month Range
- [x] **Given** today is December 2025, **When** running `mm ls next-month`, **Then** it displays items from January 1st to January 31st (2026)
- [x] **Given** today is March 2025, **When** running `mm ls last-month`, **Then** it displays items from February 1st to February 28th

#### 5. Backward Compatibility
- [x] **Given** `this-week` used in a non-range context (e.g., `mm add task "foo" --due this-week`), **When** executing, **Then** it still resolves to the single start date (Monday)

### Out of Scope
- Changing behavior of relative weekday syntax (`next-monday`, `last-friday`)
- Changing the `..` range syntax (e.g., `today..+7d`)

---

### Completed Work Summary

**Implementation completed using TDD approach.**

#### Changes Made:

1. **`src/domain/services/date_resolver.ts`**
   - Added `isPeriodKeyword()` function to detect period keywords (`this-week`, `tw`, `next-week`, `nw`, `last-week`, `lw`, `this-month`, `next-month`, `last-month`)
   - Added `resolvePeriodRange()` function that returns `{ from: CalendarDay, to: CalendarDay }`
   - Week ranges: Monday to Sunday
   - Month ranges: 1st to last day (handles leap years correctly)

2. **`src/domain/services/path_resolver.ts`**
   - Modified `resolveRange()` to detect period keywords in single path expressions
   - When a period keyword is detected, it expands to a `dateRange` instead of `single`
   - Non-period keywords (`today`, `tomorrow`, etc.) continue to resolve as single dates

3. **Tests Added:**
   - `date_resolver_test.ts`: 14 new tests for `isPeriodKeyword` and `resolvePeriodRange`
   - `path_resolver_test.ts`: 6 new tests for period keyword expansion in `resolveRange`

All 510 unit tests pass.

### Acceptance Checks

**Status: All Criteria Verified âœ…**

Developer verification completed (2026-01-01):
- AC 1.1-1.3: `mm ls this-week` / `tw` shows Mon-Sun items grouped by date
- AC 2.1-2.2: `mm ls next-week` / `last-week` show correct week ranges
- AC 3.1-3.2: `mm ls this-month` shows full month; leap year handling verified via unit test
- AC 4.1-4.2: `mm ls next-month` / `last-month` show correct month ranges
- AC 5: `-p this-week` resolves to single Monday date (backward compatible)

**All acceptance criteria passed.**

### Follow-ups / Open Risks

#### Addressed
- Week range scope: Mon-Sun (full week) per user preference
- Design decision: Range expansion implemented in `path_resolver.ts` (detects period keywords and calls `resolvePeriodRange` from `date_resolver.ts`)

#### Remaining
- None - implementation complete, awaiting product owner acceptance testing

